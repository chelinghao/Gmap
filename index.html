<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8' />
    <title></title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.47.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.47.0/mapbox-gl.css' rel='stylesheet' />
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js'></script>
    <style>
      body {
        margin: 0;
        padding: 0;
      }

      #map {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div id='map'></div>
    <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiYWRyaWFuY2hlIiwiYSI6ImNqa2theTUydzBhbnoza3BiYzdsamp2eDUifQ.58HVb8DuYh-CkQgxQOxrOg';

    var start = [];
    var end = [];

    window.onload = function() {
      ParseURLParameter();
    }

    var map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/streets-v10',
      center: [0, 0],
      zoom: 12
    });

    var point = {
      "type" : "Point",
      "coordinates" : [0, 0]
    };

    // retrieve the route
    map.on('load', function() {
      getRoute();
      setMapCenter();
    });

    function setMapCenter() {
      point.coordinates[0] = start[0];
      point.coordinates[1] = start[1];
      map.setCenter(point.coordinates);
    }
    // parse URL function
    function ParseURLParameter() {
      var fullURL = window.location.search.substring(1);
      var parameterArray = fullURL.split('&')
      start = [parameterArray[0], parameterArray[1]];
      end = [parameterArray[2], parameterArray[3]];
    }


    function getRoute() {
      var directionsRequest = 'https://api.mapbox.com/directions/v5/mapbox/cycling/' + start[0] + ',' + start[1] + ';' + end[0] + ',' + end[1] + '?geometries=geojson&access_token=' + mapboxgl.accessToken;
    $.ajax({
      method: 'GET',
      url: directionsRequest,
    }).done(function(data) {
      var route = data.routes[0].geometry;
      map.addLayer({
        id: 'route',
        type: 'line',
        source: {
          type: 'geojson',
          data: {
            type: 'Feature',
            geometry: route
          }
        },
        paint: {
          'line-width': 2
        }
      });

      // add layers for start and end point
      map.addLayer({
        id: 'start',
        type: 'circle',
        source: {
          type: 'geojson',
          data: {
            type: 'Feature',
            geometry: {
              type: 'Point',
              coordinates: start
            }
          }
        }
      });
      map.addLayer({
        id: 'end',
        type: 'circle',
        source: {
          type: 'geojson',
          data: {
            type: 'Feature',
            geometry: {
              type: 'Point',
              coordinates: end
            }
          }
        }
      });
      // this is where the JavaScript from the next step will go
    });
}
    </script>
  </body>
</html>
